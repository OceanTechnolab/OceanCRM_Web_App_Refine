# Facebook Lead Import - Visual Architecture

## ðŸ“Š System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Leads Page (src/routes/leads/list/index.tsx)              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚  [Import from Facebook Button] ðŸ“²                â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â”‚                          â†“ Opens                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚  Meta Import Modal Component                      â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  (src/components/meta-import-modal/index.tsx)    â”‚      â”‚    â”‚
â”‚  â”‚  â”‚                                                    â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  Step 1: [Log in With Facebook] ðŸ”              â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  Step 2: [Select Your Page] ðŸ“„                  â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  Step 3: [Select Lead Form] ðŸ“‹                  â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  Step 4: [Connect to CRM] âœ…                    â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FACEBOOK SDK (Client-Side)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Facebook JavaScript SDK v24.0                              â”‚    â”‚
â”‚  â”‚  Initialized in index.html                                  â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â€¢ window.FB.login() - OAuth popup                          â”‚    â”‚
â”‚  â”‚  â€¢ Handles user authentication                              â”‚    â”‚
â”‚  â”‚  â€¢ Returns access token                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FACEBOOK GRAPH API (External)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  graph.facebook.com/v24.0                                   â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  GET /me                      â†’ User info (name, email)     â”‚    â”‚
â”‚  â”‚  GET /me/accounts             â†’ List of Pages               â”‚    â”‚
â”‚  â”‚  GET /{page_id}/leadgen_forms â†’ List of lead forms          â”‚    â”‚
â”‚  â”‚  GET /{form_id}/leads         â†’ Lead submissions            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      YOUR BACKEND API (To Be Built)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  POST /meta/account                                          â”‚    â”‚
â”‚  â”‚  â€¢ Stores page_id, form_id, page_access_token               â”‚    â”‚
â”‚  â”‚  â€¢ Encrypts and saves tokens                                â”‚    â”‚
â”‚  â”‚  â€¢ Links to user account                                    â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  POST /meta/import-leads                                    â”‚    â”‚
â”‚  â”‚  â€¢ Fetches leads from Facebook                              â”‚    â”‚
â”‚  â”‚  â€¢ Maps data to CRM format                                  â”‚    â”‚
â”‚  â”‚  â€¢ Checks for duplicates                                    â”‚    â”‚
â”‚  â”‚  â€¢ Saves to database                                        â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  POST /webhooks/facebook (Optional)                         â”‚    â”‚
â”‚  â”‚  â€¢ Receives real-time notifications                         â”‚    â”‚
â”‚  â”‚  â€¢ Imports new leads immediately                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATABASE                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  meta_accounts table                                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ id                                                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ user_id                                                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ page_id                                                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ form_id                                                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ page_access_token (encrypted) ðŸ”’                       â”‚    â”‚
â”‚  â”‚  â””â”€ token_expires_at                                        â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  leads table                                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ id                                                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ name                                                     â”‚    â”‚
â”‚  â”‚  â”œâ”€ email                                                    â”‚    â”‚
â”‚  â”‚  â”œâ”€ phone                                                    â”‚    â”‚
â”‚  â”‚  â”œâ”€ source = 'facebook'                                     â”‚    â”‚
â”‚  â”‚  â”œâ”€ facebook_lead_id (unique)                               â”‚    â”‚
â”‚  â”‚  â””â”€ meta_account_id                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Data Flow Sequence

### Scenario 1: Initial Setup

```
User                    Frontend                Facebook            Backend          Database
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚  Click "Import"        â”‚                        â”‚                  â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  Open Modal            â”‚                  â”‚                â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚  Click "Login"         â”‚                        â”‚                  â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  FB.login()            â”‚                  â”‚                â”‚
  â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  OAuth Popup           â”‚                  â”‚                â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚  Grant Permissions     â”‚                        â”‚                  â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  Access Token          â”‚                  â”‚                â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  GET /me               â”‚                  â”‚                â”‚
  â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  User Info             â”‚                  â”‚                â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚  Display Name & Email  â”‚                        â”‚                  â”‚                â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  GET /me/accounts      â”‚                  â”‚                â”‚
  â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  Pages List            â”‚                  â”‚                â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚  Select Page           â”‚                        â”‚                  â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  GET /{page}/forms     â”‚                  â”‚                â”‚
  â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚  Forms List            â”‚                  â”‚                â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚  Select Form           â”‚                        â”‚                  â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚  Click "Connect"       â”‚                        â”‚                  â”‚                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚         POST /meta/account               â”‚                â”‚
  â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚  INSERT meta   â”‚
  â”‚                        â”‚                        â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚                        â”‚         Success Response                  â”‚                â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
  â”‚                        â”‚                        â”‚                  â”‚                â”‚
  â”‚  "Successfully         â”‚                        â”‚                  â”‚                â”‚
  â”‚   Connected!" âœ…       â”‚                        â”‚                  â”‚                â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                  â”‚                â”‚
```

### Scenario 2: Importing Leads (Backend Process)

```
Backend                 Facebook Graph API              Database
  â”‚                            â”‚                           â”‚
  â”‚  POST /meta/import-leads   â”‚                           â”‚
  â”‚                            â”‚                           â”‚
  â”‚  Get meta_account          â”‚                           â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                            â”‚                           â”‚
  â”‚  Account details           â”‚                           â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                            â”‚                           â”‚
  â”‚  GET /{form_id}/leads      â”‚                           â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
  â”‚                            â”‚                           â”‚
  â”‚  Leads data (JSON)         â”‚                           â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
  â”‚                            â”‚                           â”‚
  â”‚  For each lead:            â”‚                           â”‚
  â”‚  â€¢ Check if exists         â”‚                           â”‚
  â”‚  â€¢ Map data to CRM format  â”‚                           â”‚
  â”‚  â€¢ Validate                â”‚                           â”‚
  â”‚                            â”‚                           â”‚
  â”‚  INSERT leads              â”‚                           â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                            â”‚                           â”‚
  â”‚  Success                   â”‚                           â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                            â”‚                           â”‚
  â”‚  Return: {imported: 5}     â”‚                           â”‚
```

### Scenario 3: Real-time Webhook (Optional)

```
Facebook              Your Webhook              Backend                Database
  â”‚                       â”‚                        â”‚                      â”‚
  â”‚  New lead submitted   â”‚                        â”‚                      â”‚
  â”‚                       â”‚                        â”‚                      â”‚
  â”‚  POST /webhooks       â”‚                        â”‚                      â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                      â”‚
  â”‚                       â”‚                        â”‚                      â”‚
  â”‚                       â”‚  Parse notification    â”‚                      â”‚
  â”‚                       â”‚  Get lead_id, form_id  â”‚                      â”‚
  â”‚                       â”‚                        â”‚                      â”‚
  â”‚                       â”‚  Find meta_account     â”‚                      â”‚
  â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                       â”‚                        â”‚                      â”‚
  â”‚                       â”‚  Account details       â”‚                      â”‚
  â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                       â”‚                        â”‚                      â”‚
  â”‚  GET /{lead_id}       â”‚                        â”‚                      â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                      â”‚
  â”‚                       â”‚                        â”‚                      â”‚
  â”‚  Lead data            â”‚                        â”‚                      â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                      â”‚
  â”‚                       â”‚                        â”‚                      â”‚
  â”‚                       â”‚  Map & insert lead     â”‚                      â”‚
  â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                       â”‚                        â”‚                      â”‚
  â”‚  200 OK               â”‚                        â”‚                      â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                      â”‚
```

---

## ðŸ” Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TOKEN SECURITY                           â”‚
â”‚                                                             â”‚
â”‚  User Access Token (Short-lived: 1-2 hours)                â”‚
â”‚  â”œâ”€ Generated by FB.login()                                â”‚
â”‚  â”œâ”€ Sent to backend ONCE                                   â”‚
â”‚  â”œâ”€ Never stored in frontend                               â”‚
â”‚  â””â”€ Used to get Page token                                 â”‚
â”‚                                                             â”‚
â”‚  Page Access Token (Long-lived: 60 days)                   â”‚
â”‚  â”œâ”€ Obtained from /me/accounts                             â”‚
â”‚  â”œâ”€ ENCRYPTED before database storage ðŸ”’                  â”‚
â”‚  â”œâ”€ Only decrypted when needed                             â”‚
â”‚  â”œâ”€ Refreshed before expiry                                â”‚
â”‚  â””â”€ Used for all API calls                                 â”‚
â”‚                                                             â”‚
â”‚  Environment Variables                                      â”‚
â”‚  â”œâ”€ FACEBOOK_APP_SECRET (Backend only!)                    â”‚
â”‚  â”œâ”€ ENCRYPTION_KEY (Database encryption)                   â”‚
â”‚  â”œâ”€ Never committed to Git                                 â”‚
â”‚  â””â”€ Stored in secure environment                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“± Permission Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PERMISSION REQUEST FLOW                        â”‚
â”‚                                                             â”‚
â”‚  Development Mode (Before App Review)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  âœ… email                                         â”‚     â”‚
â”‚  â”‚  â€¢ Works immediately                              â”‚     â”‚
â”‚  â”‚  â€¢ Only for admins/developers/testers             â”‚     â”‚
â”‚  â”‚                                                    â”‚     â”‚
â”‚  â”‚  âŒ pages_show_list                              â”‚     â”‚
â”‚  â”‚  âŒ leads_retrieval                              â”‚     â”‚
â”‚  â”‚  âŒ Other advanced permissions                   â”‚     â”‚
â”‚  â”‚  â€¢ Need App Review approval                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚  After App Review Approval                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  âœ… All requested permissions                    â”‚     â”‚
â”‚  â”‚  â€¢ Works for all users                            â”‚     â”‚
â”‚  â”‚  â€¢ App can go "Live"                              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ—ï¸ Project File Structure

```
OceanCRM_Web_App_Refine/
â”œâ”€â”€ index.html                           # Facebook SDK initialization âš¡
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ meta-import-modal/
â”‚   â”‚       â””â”€â”€ index.tsx                # Main integration component ðŸŽ¯
â”‚   â”‚
â”‚   â””â”€â”€ routes/
â”‚       â””â”€â”€ leads/
â”‚           â””â”€â”€ list/
â”‚               â””â”€â”€ index.tsx            # Leads page with import button
â”‚
â”œâ”€â”€ DOCUMENTATION/
â”‚   â”œâ”€â”€ README_FACEBOOK_INTEGRATION.md   # ðŸ“š START HERE - Main index
â”‚   â”œâ”€â”€ QUICK_START.md                   # ðŸš€ 5-minute setup
â”‚   â”œâ”€â”€ FACEBOOK_APP_SETUP_GUIDE.md      # ðŸ“– Complete Facebook setup
â”‚   â”œâ”€â”€ IMPLEMENTATION_GUIDE.md          # ðŸ’» Technical implementation
â”‚   â”œâ”€â”€ TESTING_GUIDE.md                 # ðŸ§ª Testing procedures
â”‚   â”œâ”€â”€ PRIVACY_POLICY_TEMPLATE.md       # ðŸ“„ Legal compliance
â”‚   â”œâ”€â”€ ARCHITECTURE.md                  # ðŸ“Š This file!
â”‚   â””â”€â”€ check-facebook-setup.sh          # âœ… Verification script
â”‚
â””â”€â”€ .env.example                         # Environment configuration
```

---

## ðŸŽ¯ Implementation Status

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COMPONENT STATUS                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Frontend                                       Status       â”‚
â”‚  â”œâ”€ Facebook SDK integration                   âœ… Complete  â”‚
â”‚  â”œâ”€ OAuth login flow                           âœ… Complete  â”‚
â”‚  â”œâ”€ Multi-step wizard UI                       âœ… Complete  â”‚
â”‚  â”œâ”€ Error handling                             âœ… Complete  â”‚
â”‚  â”œâ”€ Loading states                             âœ… Complete  â”‚
â”‚  â””â”€ User info display                          âœ… Complete  â”‚
â”‚                                                              â”‚
â”‚  Backend                                        Status       â”‚
â”‚  â”œâ”€ POST /meta/account                         âŒ To Do     â”‚
â”‚  â”œâ”€ POST /meta/import-leads                    âŒ To Do     â”‚
â”‚  â”œâ”€ Token encryption                           âŒ To Do     â”‚
â”‚  â”œâ”€ Token refresh logic                        âŒ To Do     â”‚
â”‚  â”œâ”€ Data mapping                               âŒ To Do     â”‚
â”‚  â”œâ”€ Duplicate detection                        âŒ To Do     â”‚
â”‚  â””â”€ Webhook handler (optional)                 âšª Optional  â”‚
â”‚                                                              â”‚
â”‚  Facebook App                                   Status       â”‚
â”‚  â”œâ”€ App created                                âš ï¸  Verify   â”‚
â”‚  â”œâ”€ Facebook Login added                       âš ï¸  Verify   â”‚
â”‚  â”œâ”€ OAuth configured                           âš ï¸  Verify   â”‚
â”‚  â”œâ”€ Business verification                      âŒ To Do     â”‚
â”‚  â”œâ”€ Privacy Policy                             âŒ To Do     â”‚
â”‚  â””â”€ App Review submission                      âŒ To Do     â”‚
â”‚                                                              â”‚
â”‚  Database                                       Status       â”‚
â”‚  â”œâ”€ meta_accounts table                        âŒ To Do     â”‚
â”‚  â””â”€ leads table updates                        âŒ To Do     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
âœ… Complete and working
âš ï¸  Needs verification/configuration
âŒ Not yet implemented
âšª Optional feature
```

---

## ðŸ“ˆ Timeline Visualization

```
Week 1: Foundation & Testing
â”œâ”€ Day 1: Quick Start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€ Day 2: Facebook App Setup â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€ Day 3: Basic Auth Testing â”€â”€â”€â”€â”€â”€â”€â”¤  âœ… You can complete this now!
â”œâ”€ Day 4: Privacy Policy Draft â”€â”€â”€â”€â”€â”¤
â””â”€ Day 5: Business Verification â”€â”€â”€â”€â”˜

Week 2: Backend Development
â”œâ”€ Day 1: Database Schema â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€ Day 2: API Endpoints â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€ Day 3: Token Management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  ðŸ”§ Development phase
â”œâ”€ Day 4: Lead Import Logic â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€ Day 5: Testing & Debugging â”€â”€â”€â”€â”€â”€â”˜

Week 3: App Review
â”œâ”€ Day 1: Demo Video â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€ Day 2: App Review Submission â”€â”€â”€â”€â”¤  â³ Waiting period
â”œâ”€ Day 3-7: Waiting â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Week 4: Launch
â”œâ”€ Day 1: Production Deploy â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€ Day 2: Testing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  ðŸš€ Go live!
â”œâ”€ Day 3: Monitoring â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€ Day 4-5: User Training â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total: ~4 weeks from start to production
```

---

## ðŸ” Error Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ERROR HANDLING FLOW                         â”‚
â”‚                                                               â”‚
â”‚  User Action                                                  â”‚
â”‚      â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ Try API  â”‚                                                â”‚
â”‚  â”‚ Call     â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚       â”‚                                                       â”‚
â”‚       â”œâ”€â”€â†’ Success â”€â”€â†’ Display result â”€â”€â†’ Next step         â”‚
â”‚       â”‚                                                       â”‚
â”‚       â”œâ”€â”€â†’ Network Error â”€â”€â†’ Show error message             â”‚
â”‚       â”‚                     â”‚                                â”‚
â”‚       â”‚                     â””â”€â†’ Retry button available       â”‚
â”‚       â”‚                                                       â”‚
â”‚       â”œâ”€â”€â†’ Permission Denied â”€â”€â†’ "Please grant permissions" â”‚
â”‚       â”‚                          â”‚                            â”‚
â”‚       â”‚                          â””â”€â†’ Re-login button          â”‚
â”‚       â”‚                                                       â”‚
â”‚       â”œâ”€â”€â†’ Token Expired â”€â”€â†’ Auto re-authenticate           â”‚
â”‚       â”‚                      â”‚                                â”‚
â”‚       â”‚                      â””â”€â†’ Retry original action        â”‚
â”‚       â”‚                                                       â”‚
â”‚       â””â”€â”€â†’ Other Error â”€â”€â†’ Display error                     â”‚
â”‚                           â”‚                                   â”‚
â”‚                           â”œâ”€â†’ Log to console                  â”‚
â”‚                           â””â”€â†’ Report to monitoring            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“š Related Documentation

- **Main Index**: README_FACEBOOK_INTEGRATION.md
- **Quick Start**: QUICK_START.md
- **Full Setup**: FACEBOOK_APP_SETUP_GUIDE.md
- **Implementation**: IMPLEMENTATION_GUIDE.md
- **Testing**: TESTING_GUIDE.md

---

_This architecture document provides a visual overview of the system.  
For detailed implementation instructions, see the other guide files._
